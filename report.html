<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Student Evaluation Report</title>

<!-- Chart.js for Trend Graphs -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
    max-width: 950px;
    margin: auto;
  }

  h1 {
    margin-bottom: 10px;
  }

  .section {
    margin-bottom: 20px;
  }

  .student-select {
    margin-bottom: 15px;
    background: #eef0ff;
    padding: 12px;
    border-radius: 10px;
  }

  .student-select select {
    padding: 8px;
    font-size: 1.1em;
  }

  .date-filter {
    display: flex;
    gap: 14px;
    align-items: center;
    margin-bottom: 15px;
    padding: 12px;
    background: #f5f5ff;
    border-radius: 10px;
  }

  .comment-toggle {
    margin: 10px 0;
    font-size: 1.12em;
  }

  .pretty-list {
    list-style: none;
    padding: 0;
  }

  .date-item {
    padding: 12px 16px;
    margin: 6px 0;
    background: #f0f0f8;
    border-radius: 8px;
    cursor: pointer;
    transition: 0.2s ease;
    font-size: 1.1em;
  }

  .date-item:hover {
    background: #dedcff;
    transform: translateX(6px);
  }

  .details-panel {
    margin-top: 20px;
    padding: 15px;
    background: #fafafa;
    border-radius: 10px;
    border: 1px solid #ddd;
  }

  .hidden {
    display: none;
  }

  .chart-container {
    margin-top: 40px;
    padding: 20px;
    background: #ffffff;
    border-radius: 12px;
    border: 1px solid #ddd;
  }

  .comment-box {
    margin-top: 15px;
    padding: 12px;
    background: #eef2ff;
    border-left: 4px solid #6b6bff;
    border-radius: 6px;
  }

  .evaluator-box {
    margin-top: 10px;
    padding: 10px;
    background: #f3f7ff;
    border-left: 4px solid #3b7bff;
    border-radius: 6px;
  }

</style>
</head>

<body>

<h1>Student Evaluation Report</h1>

<!-- STUDENT SELECTOR -->
<div class="student-select">
  <label><strong>Select Student:</strong></label>
  <select id="studentSelect"></select>
</div>

<!-- DATE RANGE FILTER -->
<div class="date-filter">
  <label>From:
    <input type="date" id="startDate">
  </label>
  <label>To:
    <input type="date" id="endDate">
  </label>
  <button id="filterBtn">Filter</button>
</div>

<!-- COMMENT TOGGLE -->
<div class="comment-toggle">
  <label>
    <input type="checkbox" id="showComments" checked>
    Show Comments
  </label>
</div>

<!-- DATE LIST -->
<ul id="entryDateList" class="pretty-list"></ul>

<!-- ENTRY DETAILS -->
<div id="entryDetails" class="details-panel hidden"></div>

<!-- TREND GRAPH -->
<div class="chart-container hidden" id="chartContainer">
  <h3>Trend Graph</h3>
  <canvas id="trendChart" height="150"></canvas>
</div>

<script>
/* ==========================================================
   MOCK: Fetch student list  
   Replace with your backend call
   ========================================================== */
async function getStudents() {
  return [
    { id: "s1", name: "Alice Johnson" },
    { id: "s2", name: "Brandon Lee" },
    { id: "s3", name: "Charlotte Rivera" }
  ];
}

/* ==========================================================
   MOCK: Fetch entries for a student
   Replace this with your real data source
   ========================================================== */
async function getEntriesForStudent(studentId) {
  return [
    {
      date: "2026-01-12",
      values: {
        attention: 4,
        cooperation: 5,
        pace: 3,
        comment: "Excellent cooperation today.",
        evaluator: "Mr. Thomas"
      }
    },
    {
      date: "2026-01-10",
      values: {
        attention: 3,
        cooperation: 4,
        pace: 4,
        comment: "Improvement in pace.",
        evaluator: "Ms. Clark"
      }
    },
    {
      date: "2026-01-05",
      values: {
        attention: 2,
        cooperation: 3,
        pace: 5,
        comment: "",
        evaluator: "Mr. Thomas"
      }
    }
  ];
}

/* ==========================================================
   GLOBAL STATE
   ========================================================== */
let allEntries = [];
let currentEntry = null;
let chart = null;

/* ==========================================================
   LOAD STUDENT SELECTOR
   ========================================================== */
async function loadStudentSelector() {
  const students = await getStudents();
  const select = document.getElementById("studentSelect");

  students.forEach(s => {
    const opt = document.createElement("option");
    opt.value = s.id;
    opt.textContent = s.name;
    select.appendChild(opt);
  });

  // load first student automatically
  loadReportForStudent(select.value);

  select.onchange = () => {
    loadReportForStudent(select.value);
  };
}

/* ==========================================================
   LOAD REPORT FOR STUDENT
   ========================================================== */
async function loadReportForStudent(studentId) {
  allEntries = await getEntriesForStudent(studentId);

  // Sort by date ascending
  allEntries.sort((a, b) => new Date(a.date) - new Date(b.date));

  renderDateList(allEntries);
  generateTrendGraph(allEntries);

  document.getElementById("entryDetails").classList.add("hidden");
  currentEntry = null;
}

/* ==========================================================
   FORMAT DATE
   ========================================================== */
function formatDate(dateStr) {
  const d = new Date(dateStr);
  return d.toLocaleDateString(undefined, {
    year:"numeric", month:"long", day:"numeric"
  });
}

/* ==========================================================
   DATE LIST
   ========================================================== */
function renderDateList(entries) {
  const list = document.getElementById("entryDateList");
  list.innerHTML = "";

  if (entries.length === 0) {
    list.innerHTML = "<li>No entries found in this range.</li>";
    document.getElementById("chartContainer").classList.add("hidden");
    return;
  }

  entries.forEach(entry => {
    const li = document.createElement("li");
    li.className = "date-item";
    li.textContent = formatDate(entry.date);
    li.onclick = () => showEntryDetails(entry);
    list.appendChild(li);
  });
}

/* ==========================================================
   ENTRY DETAILS (WITH EVALUATOR + COMMENT TOGGLE)
   ========================================================== */
function showEntryDetails(entry) {
  currentEntry = entry;

  const panel = document.getElementById("entryDetails");
  panel.classList.remove("hidden");

  const showComments = document.getElementById("showComments").checked;

  panel.innerHTML = `
    <h3>Entry for ${formatDate(entry.date)}</h3>

    <div class="evaluator-box">
      <strong>Evaluator:</strong> ${entry.values.evaluator || "Unknown"}
    </div>

    <pre>${JSON.stringify(entry.values, null, 2)}</pre>

    ${showComments && entry.values.comment ? `
      <div class="comment-box">
        <h4>Comment</h4>
        <p>${entry.values.comment}</p>
      </div>
    ` : ""}
  `;
}

/* ==========================================================
   COMMENT TOGGLE REFRESH
   ========================================================== */
document.getElementById("showComments").onchange = () => {
  if (currentEntry) {
    showEntryDetails(currentEntry);
  }
};

/* ==========================================================
   TREND GRAPH
   ========================================================== */
function generateTrendGraph(entries) {
  const container = document.getElementById("chartContainer");
  container.classList.remove("hidden");

  const ctx = document.getElementById("trendChart").getContext("2d");

  if (chart) chart.destroy();

  const labels = entries.map(e => formatDate(e.date));

  // Values except comment and evaluator
  const categories = Object.keys(entries[0].values)
    .filter(k => k !== "comment" && k !== "evaluator");

  const datasets = categories.map((category, idx) => ({
    label: category,
    data: entries.map(e => e.values[category]),
    borderColor: getColor(idx),
    backgroundColor: getColor(idx) + "55",
    borderWidth: 2,
    tension: 0.3
  }));

  chart = new Chart(ctx, {
    type: "line",
    data: { labels, datasets },
    options: {
      responsive: true,
      scales: {
        y: { beginAtZero: true, max: 5 }
      }
    }
  });
}

/* ==========================================================
   LINE COLORS
   ========================================================== */
function getColor(i) {
  const colors = [
    "#ff6384", "#36a2eb", "#4bc0c0", "#9966ff",
    "#ff9f40", "#8bc34a", "#ec407a", "#26c6da"
  ];
  return colors[i % colors.length];
}

/* ==========================================================
   DATE RANGE FILTER
   ========================================================== */
document.getElementById("filterBtn").onclick = () => {
  const start = new Date(document.getElementById("startDate").value);
  const end = new Date(document.getElementById("endDate").value);

  if (isNaN(start) || isNaN(end)) {
    alert("Please choose a valid date range.");
    return;
  }

  end.setHours(23, 59, 59, 999);

  const filtered = allEntries.filter(e => {
    const d = new Date(e.date);
    return d >= start && d <= end;
  });

  renderDateList(filtered);

  if (filtered.length > 0) {
    generateTrendGraph(filtered);
  } else {
    document.getElementById("chartContainer").classList.add("hidden");
  }

  document.getElementById("entryDetails").classList.add("hidden");
  currentEntry = null;
};

/* ==========================================================
   INIT
   ========================================================== */
loadStudentSelector();

</script>

</body>
</html>

