<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Student Evaluation Report</title>

<!-- Chart.js for Trend Graphs -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
    max-width: 950px;
    margin: auto;
  }

  h1 {
    margin-bottom: 10px;
  }

  .date-filter {
    display: flex;
    gap: 14px;
    align-items: center;
    margin-bottom: 15px;
    padding: 12px;
    background: #f5f5ff;
    border-radius: 10px;
  }

  .comment-toggle {
    margin: 10px 0 20px 0;
    font-size: 1.12em;
  }

  .pretty-list {
    list-style: none;
    padding: 0;
  }

  .date-item {
    padding: 12px 16px;
    margin: 6px 0;
    background: #f0f0f8;
    border-radius: 8px;
    cursor: pointer;
    transition: 0.2s ease;
    font-size: 1.1em;
  }

  .date-item:hover {
    background: #dedcff;
    transform: translateX(6px);
  }

  .details-panel {
    margin-top: 20px;
    padding: 15px;
    background: #fafafa;
    border-radius: 10px;
    border: 1px solid #ddd;
  }

  .hidden {
    display: none;
  }

  .chart-container {
    margin-top: 40px;
    padding: 20px;
    background: #ffffff;
    border-radius: 12px;
    border: 1px solid #ddd;
  }

  .comment-box {
    margin-top: 15px;
    padding: 12px;
    background: #eef2ff;
    border-left: 4px solid #6b6bff;
    border-radius: 6px;
  }
</style>
</head>

<body>

<h1>Student Evaluation Report</h1>

<!-- Date Range Filter -->
<div class="date-filter">
  <label>From:
    <input type="date" id="startDate">
  </label>
  <label>To:
    <input type="date" id="endDate">
  </label>
  <button id="filterBtn">Filter</button>
</div>

<!-- Show/Hide Comments Toggle -->
<div class="comment-toggle">
  <label>
    <input type="checkbox" id="showComments" checked>
    Show Comments
  </label>
</div>

<!-- Date List -->
<ul id="entryDateList" class="pretty-list"></ul>

<!-- Entry Details -->
<div id="entryDetails" class="details-panel hidden"></div>

<!-- Trend Chart -->
<div class="chart-container hidden" id="chartContainer">
  <h3>Trend Graph</h3>
  <canvas id="trendChart" height="150"></canvas>
</div>

<script>
/* ===============================================
   DATE FORMAT HELPER
   =============================================== */
function formatDate(dateStr) {
  const d = new Date(dateStr);
  return d.toLocaleDateString(undefined, { year:"numeric", month:"long", day:"numeric" });
}

/* ===============================================
   MOCK BACKEND DATA (Replace With Yours)
   =============================================== */
async function getEntriesForStudent(studentId) {
  return [
    {
      date: "2026-01-12",
      values: { attention: 4, cooperation: 5, pace: 3 },
      comment: "Excellent cooperation today."
    },
    {
      date: "2026-01-10",
      values: { attention: 3, cooperation: 4, pace: 4 },
      comment: "Improvement in pace, good effort."
    },
    {
      date: "2026-01-05",
      values: { attention: 2, cooperation: 3, pace: 5 },
      comment: ""
    }
  ];
}

/* ===============================================
   GLOBAL STATE
   =============================================== */
let allEntries = [];
let currentEntry = null;
let chart = null;

/* ===============================================
   LOAD REPORT
   =============================================== */
async function loadReport() {
  const studentId = "example-student";
  allEntries = await getEntriesForStudent(studentId);

  // sort by date ascending for graphing
  allEntries.sort((a, b) => new Date(a.date) - new Date(b.date));

  renderDateList(allEntries);
  generateTrendGraph(allEntries);
}

/* ===============================================
   RENDER DATE LIST
   =============================================== */
function renderDateList(entries) {
  const list = document.getElementById("entryDateList");
  list.innerHTML = "";

  if (entries.length === 0) {
    list.innerHTML = "<li>No entries found in this range.</li>";
    document.getElementById("chartContainer").classList.add("hidden");
    return;
  }

  entries.forEach(entry => {
    const li = document.createElement("li");
    li.className = "date-item";
    li.textContent = formatDate(entry.date);
    li.onclick = () => showEntryDetails(entry);
    list.appendChild(li);
  });
}

/* ===============================================
   SHOW ENTRY DETAILS (WITH COMMENTS TOGGLE)
   =============================================== */
function showEntryDetails(entry) {
  currentEntry = entry;

  const panel = document.getElementById("entryDetails");
  panel.classList.remove("hidden");

  const showComments = document.getElementById("showComments").checked;

  panel.innerHTML = `
    <h3>Entry for ${formatDate(entry.date)}</h3>
    <pre>${JSON.stringify(entry.values, null, 2)}</pre>

    ${showComments && entry.comment ? `
      <div class="comment-box">
        <h4>Comment</h4>
        <p>${entry.comment}</p>
      </div>
    ` : ""}
  `;
}

/* ===============================================
   COMMENT TOGGLE REFRESHES DETAILS
   =============================================== */
document.getElementById("showComments").onchange = () => {
  if (currentEntry) {
    showEntryDetails(currentEntry);
  }
};

/* ===============================================
   TREND GRAPH (Chart.js)
   =============================================== */
function generateTrendGraph(entries) {
  const container = document.getElementById("chartContainer");
  container.classList.remove("hidden");

  const ctx = document.getElementById("trendChart").getContext("2d");

  if (chart) chart.destroy();

  const labels = entries.map(e => formatDate(e.date));
  const categories = Object.keys(entries[0].values);

  const datasets = categories.map((category, idx) => {
    return {
      label: category,
      data: entries.map(e => e.values[category]),
      borderColor: getColor(idx),
      backgroundColor: getColor(idx) + "55",
      borderWidth: 2,
      tension: 0.3
    };
  });

  chart = new Chart(ctx, {
    type: "line",
    data: { labels, datasets },
    options: {
      responsive: true,
      scales: {
        y: { beginAtZero: true, max: 5 }
      }
    }
  });
}

/* ===============================================
   LINE COLORS
   =============================================== */
function getColor(i) {
  const colors = [
    "#ff6384", "#36a2eb", "#4bc0c0", "#9966ff",
    "#ff9f40", "#8bc34a", "#ec407a", "#26c6da"
  ];
  return colors[i % colors.length];
}

/* ===============================================
   DATE RANGE FILTER
   =============================================== */
document.getElementById("filterBtn").onclick = () => {
  const start = new Date(document.getElementById("startDate").value);
  const end = new Date(document.getElementById("endDate").value);

  if (isNaN(start) || isNaN(end)) {
    alert("Please choose a valid date range.");
    return;
  }

  end.setHours(23, 59, 59, 999);

  const filtered = allEntries.filter(e => {
    const d = new Date(e.date);
    return d >= start && d <= end;
  });

  renderDateList(filtered);

  if (filtered.length > 0) {
    generateTrendGraph(filtered);
  } else {
    document.getElementById("chartContainer").classList.add("hidden");
  }

  document.getElementById("entryDetails").classList.add("hidden");
  currentEntry = null;
};

loadReport();
</script>

</body>
</html>
