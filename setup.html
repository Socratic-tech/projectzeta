<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Setup Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        function copyCode() {
            const codeText = document.getElementById('scriptCode').innerText;
            navigator.clipboard.writeText(codeText).then(() => {
                const btn = document.getElementById('copyBtn');
                btn.innerText = "Copied!";
                btn.classList.add("bg-green-600");
                setTimeout(() => {
                    btn.innerText = "Copy Script Code";
                    btn.classList.remove("bg-green-600");
                }, 2000);
            });
        }
    </script>
</head>
<body class="bg-gray-50 text-gray-900 font-sans pb-10">

    <nav class="bg-white shadow border-b border-gray-200 mb-8 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex">
                    <div class="flex-shrink-0 flex items-center">
                        <h1 class="text-xl font-bold text-indigo-600">Vocational Tracker</h1>
                    </div>
                    <div class="hidden sm:ml-6 sm:flex sm:space-x-8">
                        <a href="index.html" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">Dashboard</a>
                        <a href="entry.html" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">New Entry</a>
                        <a href="report.html" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">Reports</a>
                        <a href="admin.html" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">Admin</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-4xl mx-auto px-4">
        
        <div class="text-center mb-10">
            <h1 class="text-4xl font-extrabold text-gray-900 sm:text-5xl">Installation Guide</h1>
            <p class="mt-4 text-xl text-gray-500">How to replicate this tool for your own school or program.</p>
        </div>

        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
            <div class="flex items-center mb-4">
                <span class="bg-indigo-600 text-white rounded-full h-8 w-8 flex items-center justify-center font-bold mr-3">1</span>
                <h2 class="text-xl font-bold">Create the Database (Google Sheets)</h2>
            </div>
            <p class="text-gray-600 ml-11 mb-2">
                This tool uses a free Google Sheet to store all data.
            </p>
            <ol class="list-decimal list-inside ml-11 text-gray-700 space-y-2">
                <li>Go to <a href="https://sheets.google.com" target="_blank" class="text-indigo-600 underline">sheets.google.com</a> and create a <strong>Blank Spreadsheet</strong>.</li>
                <li>Name it <span class="font-mono bg-gray-100 px-1 rounded">Vocational Tracker Database</span>.</li>
                <li><strong>Do not rename the tabs yet.</strong> The script will do this for you automatically.</li>
            </ol>
        </div>

        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
            <div class="flex items-center mb-4">
                <span class="bg-indigo-600 text-white rounded-full h-8 w-8 flex items-center justify-center font-bold mr-3">2</span>
                <h2 class="text-xl font-bold">Install the Backend Script</h2>
            </div>
            <p class="text-gray-600 ml-11 mb-4">
                This script acts as the "brain" connecting the website to your spreadsheet.
            </p>
            <ol class="list-decimal list-inside ml-11 text-gray-700 space-y-2 mb-4">
                <li>In your new Google Sheet, click <strong>Extensions</strong> > <strong>Apps Script</strong>.</li>
                <li>Delete any code currently in the editor (e.g., <code>function myFunction()...</code>).</li>
                <li>Copy the code below and paste it into the editor.</li>
            </ol>
            
            <div class="ml-11 relative">
                <button id="copyBtn" onclick="copyCode()" class="absolute top-2 right-2 bg-indigo-600 text-white text-xs px-3 py-1 rounded hover:bg-indigo-700 transition">
                    Copy Script Code
                </button>
                <pre class="bg-gray-900 text-gray-100 p-4 rounded text-xs overflow-x-auto h-64 select-all" id="scriptCode">
function doGet(e) {
  const action = e.parameter.action;
  if (action === "getStudents") return getStudents();
  if (action === "getJobSites") return getJobSites();
  if (action === "getEntries") return getEntries();
  return ContentService.createTextOutput(JSON.stringify({ status: "error" })).setMimeType(ContentService.MimeType.JSON);
}

function doPost(e) {
  try {
    const data = JSON.parse(e.postData.contents);
    const action = data.action;
    if (action === "addEntry") return addEntry(data);
    if (action === "addStudent") return addStudent(data);
    if (action === "addJobSite") return addJobSite(data);
    if (action === "deleteJobSite") return deleteJobSite(data);
    return responseJSON({ status: "error" });
  } catch (error) { return responseJSON({ status: "error", message: error.toString() }); }
}

function getStudents() {
  const sheet = getSheet("Students");
  const data = sheet.getDataRange().getValues();
  const students = [];
  for (let i = 1; i < data.length; i++) {
    if (data[i][0]) students.push({ student_id: data[i][0], name: data[i][1] });
  }
  return responseJSON({ data: students });
}

function getJobSites() {
  const sheet = getSheet("JobSites");
  const data = sheet.getDataRange().getValues();
  const sites = [];
  for (let i = 1; i < data.length; i++) {
    if (data[i][0]) sites.push(data[i][0]);
  }
  return responseJSON({ data: sites.sort() });
}

function getEntries() {
  const sheet = getSheet("Entries");
  const data = sheet.getDataRange().getValues();
  const entries = [];
  for (let i = 1; i < data.length; i++) {
    if (data[i][2]) { 
      let scores = [];
      try { scores = JSON.parse(data[i][5]); } catch(e) { scores = []; }
      entries.push({
        timestamp: data[i][0], date: data[i][1], student_id: data[i][2],
        job_site: data[i][3], evaluator: data[i][4], scores: scores, comments: data[i][6]
      });
    }
  }
  return responseJSON({ data: entries });
}

function addEntry(data) {
  const sheet = getSheet("Entries");
  sheet.appendRow([new Date(), data.date, data.student_id, data.job_site, data.evaluator, data.scores, data.comments]);
  return responseJSON({ status: "success" });
}

function addStudent(data) {
  const sheet = getSheet("Students");
  const id = "STU" + Date.now(); 
  sheet.appendRow([id, data.name]);
  return responseJSON({ status: "success", id: id });
}

function addJobSite(data) {
  const sheet = getSheet("JobSites");
  sheet.appendRow([data.site_name]);
  return responseJSON({ status: "success" });
}

function deleteJobSite(data) {
  const sheet = getSheet("JobSites");
  const rows = sheet.getDataRange().getValues();
  for (let i = rows.length - 1; i >= 0; i--) {
    if (rows[i][0] === data.site_name) sheet.deleteRow(i + 1);
  }
  return responseJSON({ status: "success" });
}

function getSheet(name) {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  let sheet = ss.getSheetByName(name);
  if (!sheet) {
    sheet = ss.insertSheet(name);
    if (name === "Students") sheet.appendRow(["Student ID", "Name"]);
    if (name === "JobSites") sheet.appendRow(["Site Name"]);
    if (name === "Entries") sheet.appendRow(["Timestamp", "Date", "Student ID", "Job Site", "Evaluator", "Scores", "Comments"]);
  }
  return sheet;
}

function responseJSON(data) {
  return ContentService.createTextOutput(JSON.stringify(data)).setMimeType(ContentService.MimeType.JSON);
}
                </pre>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
            <div class="flex items-center mb-4">
                <span class="bg-indigo-600 text-white rounded-full h-8 w-8 flex items-center justify-center font-bold mr-3">3</span>
                <h2 class="text-xl font-bold">Deploy the Script</h2>
            </div>
            <p class="text-gray-600 ml-11 mb-2">
                This is the most important step to make the tool accessible.
            </p>
            <ul class="list-disc list-inside ml-11 text-gray-700 space-y-2">
                <li>In the Apps Script window, click the blue <strong>Deploy</strong> button (top right) > <strong>New Deployment</strong>.</li>
                <li>Click the <strong>Gear Icon</strong> (Select type) > <strong>Web App</strong>.</li>
                <li><strong>Description:</strong> "Version 1" (or anything you like).</li>
                <li><strong>Execute as:</strong> <span class="bg-yellow-100 px-1 rounded font-bold">Me (your email)</span>.</li>
                <li><strong>Who has access:</strong> <span class="bg-red-100 px-1 rounded font-bold text-red-700">Anyone</span>. (Crucial for the app to work).</li>
                <li>Click <strong>Deploy</strong>. You may need to authorize permissions (Click Review Permissions > Choose Account > Advanced > Go to Untitled Project (unsafe)).</li>
                <li><strong>COPY THE WEB APP URL</strong> generated at the end.</li>
            </ul>
        </div>

        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
            <div class="flex items-center mb-4">
                <span class="bg-indigo-600 text-white rounded-full h-8 w-8 flex items-center justify-center font-bold mr-3">4</span>
                <h2 class="text-xl font-bold">Connect the App</h2>
            </div>
            <p class="text-gray-600 ml-11 mb-2">
                Link your new database to this interface.
            </p>
            <ol class="list-decimal list-inside ml-11 text-gray-700 space-y-2">
                <li>Go to the <a href="admin.html" class="text-indigo-600 font-bold hover:underline">Admin Page</a> of this tool.</li>
                <li>Paste the Web App URL into the <strong>API Connection</strong> box.</li>
                <li>Click <strong>Save</strong>.</li>
                <li>Once connected, try adding a <strong>New Student</strong> in the Admin panel. This will automatically create the necessary tabs in your Google Sheet.</li>
            </ol>
        </div>

        <div class="bg-green-50 border border-green-200 rounded p-4 text-center text-green-800 font-bold">
            ðŸŽ‰ You are all set! The tool is now running on your own Google Sheet.
        </div>

    </div>
</body>
</html>
