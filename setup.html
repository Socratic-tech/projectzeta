<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Setup Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        .code-block {
            font-family: 'Courier New', Courier, monospace;
            white-space: pre-wrap;
            word-break: break-all;
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 font-sans min-h-screen flex flex-col">

    <nav class="bg-slate-800 border-b border-slate-700 p-4 sticky top-0 z-50">
        <div class="max-w-4xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-2">
                <span class="material-icons text-blue-400">build</span>
                <span class="font-bold text-xl">System Setup</span>
            </div>
            <a href="index.html" class="text-slate-400 hover:text-white text-sm">Return to App</a>
        </div>
    </nav>

    <div class="max-w-4xl mx-auto p-6 space-y-12">

        <div class="text-center space-y-4">
            <h1 class="text-3xl font-bold">Vocational Tracking System Setup</h1>
            <p class="text-slate-400">Follow these 3 steps to configure your Google Sheet backend.</p>
        </div>

        <div class="bg-slate-800 p-6 rounded-xl border border-slate-700">
            <div class="flex items-center gap-4 mb-6">
                <div class="bg-blue-600 text-white w-10 h-10 rounded-full flex items-center justify-center font-bold text-lg">1</div>
                <h2 class="text-xl font-bold">Create 4 Sheets (Tabs)</h2>
            </div>
            
            <p class="text-slate-400 mb-4">Open a new Google Sheet and create exactly these 4 tabs at the bottom:</p>

            <div class="grid gap-6 md:grid-cols-2">
                <div class="bg-slate-900 p-4 rounded border border-slate-600">
                    <h3 class="font-bold text-green-400 mb-2">Tab 1: "Entries"</h3>
                    <p class="text-xs text-slate-500 mb-2">Copy these exact headers into Row 1 (A1 to V1):</p>
                    <ul class="text-xs space-y-1 text-slate-300 list-disc pl-4">
                        <li><strong>A1:</strong> Entry ID</li>
                        <li><strong>B1:</strong> Date</li>
                        <li><strong>C1:</strong> Student ID</li>
                        <li><strong>D1:</strong> Job Site</li>
                        <li><strong>E1:</strong> Evaluator</li>
                        <li><strong>F1-U1 (Skills):</strong> <em>See list below (Must match exactly)</em></li>
                        <li><strong>V1:</strong> Comments</li>
                    </ul>
                    <div class="mt-3 p-2 bg-black rounded text-[10px] text-green-300 font-mono border border-green-900">
                        Punctual, Prepared with Necessary Materials, Demonstrates appropriate hygiene/dress, Initiates familiar tasks, Maintains a productive work rate, Complete tasks in a logical order, Demonstrates adaptability, Work is completed to quality standards, Maintains clean and organized work space, Awareness of surroundings and good decision making, Appropriate and respectful social interactions, Displays effective communication skills, Accepts constructive criticism, Demonstrates a positive attitude, Asks for help appropriately, Demonstrates self-reflection
                    </div>
                </div>

                <div class="bg-slate-900 p-4 rounded border border-slate-600">
                    <h3 class="font-bold text-purple-400 mb-2">Tab 2: "Students"</h3>
                    <ul class="text-xs space-y-1 text-slate-300 list-disc pl-4">
                        <li><strong>A1:</strong> Student ID</li>
                        <li><strong>B1:</strong> Name</li>
                        <li><strong>C1:</strong> Grade</li>
                    </ul>
                </div>

                <div class="bg-slate-900 p-4 rounded border border-slate-600">
                    <h3 class="font-bold text-orange-400 mb-2">Tab 3: "JobSites"</h3>
                    <ul class="text-xs space-y-1 text-slate-300 list-disc pl-4">
                        <li><strong>A1:</strong> Site Name</li>
                    </ul>
                </div>

                <div class="bg-slate-900 p-4 rounded border border-slate-600">
                    <h3 class="font-bold text-gray-400 mb-2">Tab 4: "Settings"</h3>
                    <ul class="text-xs space-y-1 text-slate-300 list-disc pl-4">
                        <li><strong>A1:</strong> Admin Password Label</li>
                        <li><strong>B1:</strong> (Leave Empty)</li>
                        <li><strong>A2:</strong> Password Value</li>
                        <li><strong>B2:</strong> <em>[Type your admin password here]</em></li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="bg-slate-800 p-6 rounded-xl border border-slate-700">
            <div class="flex items-center gap-4 mb-6">
                <div class="bg-blue-600 text-white w-10 h-10 rounded-full flex items-center justify-center font-bold text-lg">2</div>
                <h2 class="text-xl font-bold">Install the Script</h2>
            </div>

            <ol class="list-decimal pl-5 space-y-2 text-slate-300 mb-4">
                <li>In your Google Sheet, go to <strong>Extensions > Apps Script</strong>.</li>
                <li>Delete any code currently in the editor.</li>
                <li>Copy the code below and paste it in.</li>
                <li>Click the disk icon (Save).</li>
            </ol>

            <div class="relative group">
                <button onclick="copyCode()" class="absolute top-2 right-2 bg-blue-600 hover:bg-blue-500 text-white text-xs px-3 py-1 rounded shadow">
                    COPY CODE
                </button>
                <textarea id="scriptCode" class="w-full h-64 bg-slate-950 text-green-400 font-mono text-xs p-4 rounded border border-slate-600 focus:outline-none" readonly>
// CONFIGURATION
const SPREADSHEET_ID = ""; 
const SHEET_NAME_ENTRIES = "Entries";
const SHEET_NAME_STUDENTS = "Students";
const SHEET_NAME_SETTINGS = "Settings";
const SHEET_NAME_JOBSITES = "JobSites";

function doGet(e) {
  const action = e.parameter.action;
  if (action === "checkAdmin") return checkAdminPassword(e.parameter.password);
  if (action === "getStudents") return getStudents();
  if (action === "getJobSites") return getJobSites();
  if (action === "getEntries") return getEntries();
  return responseJSON({status: "error", message: "Invalid Action"});
}

function doPost(e) {
  try {
    const data = JSON.parse(e.postData.contents);
    const act = data.action;
    if (act === "addEntry") return addEntry(data);
    if (act === "addStudent") return addStudent(data);
    if (act === "deleteStudent") return deleteStudent(data);
    if (act === "addJobSite") return addJobSite(data);
    if (act === "deleteJobSite") return deleteJobSite(data);
    return responseJSON({status: "error", message: "Invalid Action"});
  } catch (err) {
    return responseJSON({status: "error", message: err.toString()});
  }
}

// --- LOGIC ---

function checkAdminPassword(inputPass) {
  const sheet = getSpreadsheet().getSheetByName(SHEET_NAME_SETTINGS);
  const realPass = sheet.getRange("B2").getValue().toString();
  return responseJSON({result: (inputPass === realPass ? "success" : "error")});
}

function getJobSites() {
  const sheet = getSpreadsheet().getSheetByName(SHEET_NAME_JOBSITES);
  if (!sheet) return responseJSON({status: "error", message: "Sheet missing"});
  const data = sheet.getDataRange().getValues();
  if (data.length > 0) data.shift(); 
  const sites = data.flat().filter(s => s !== "" && s !== null);
  return responseJSON({status: "success", data: sites});
}

function addJobSite(data) {
  const sheet = getSpreadsheet().getSheetByName(SHEET_NAME_JOBSITES);
  sheet.appendRow([data.site_name]); 
  return responseJSON({status: "success"});
}

function deleteJobSite(data) {
  const sheet = getSpreadsheet().getSheetByName(SHEET_NAME_JOBSITES);
  const rows = sheet.getDataRange().getValues();
  for (let i = 0; i < rows.length; i++) {
    if (rows[i][0] == data.site_name) {
      sheet.deleteRow(i + 1);
      return responseJSON({status: "success"});
    }
  }
  return responseJSON({status: "error", message: "Not found"});
}

function getStudents() {
  const sheet = getSpreadsheet().getSheetByName(SHEET_NAME_STUDENTS);
  const data = sheet.getDataRange().getValues();
  data.shift(); 
  const students = data.map(row => ({ student_id: row[0], name: row[1], grade: row[2] })).filter(s => s.student_id !== "");
  return responseJSON({status: "success", data: students});
}

function addStudent(data) {
  const sheet = getSpreadsheet().getSheetByName(SHEET_NAME_STUDENTS);
  sheet.appendRow([Utilities.getUuid(), data.name, data.grade]);
  return responseJSON({status: "success"});
}

function deleteStudent(data) {
  const sheet = getSpreadsheet().getSheetByName(SHEET_NAME_STUDENTS);
  const rows = sheet.getDataRange().getValues();
  for (let i = 0; i < rows.length; i++) {
    if (rows[i][0] == data.student_id) {
      sheet.deleteRow(i + 1);
      return responseJSON({status: "success"});
    }
  }
  return responseJSON({status: "error"});
}

function addEntry(data) {
  const sheet = getSpreadsheet().getSheetByName(SHEET_NAME_ENTRIES);
  const headers = sheet.getRange("1:1").getValues()[0];
  let newRow = [
    Utilities.getUuid(), data.date, data.student_id, data.job_site, data.evaluator
  ];
  // Skills F(5) to U(20)
  for (let i = 5; i <= 20; i++) {
    newRow[i] = data.scores[headers[i]] || "";
  }
  // Comments V(21)
  newRow[21] = data.comments;
  sheet.appendRow(newRow);
  return responseJSON({status: "success"});
}

function getEntries() {
  const sheet = getSpreadsheet().getSheetByName(SHEET_NAME_ENTRIES);
  const data = sheet.getDataRange().getValues();
  const headers = data.shift();
  const entries = data.map(row => {
    let entry = {
      entry_id: row[0], date: row[1], student_id: row[2], 
      job_site: row[3], evaluator: row[4], scores: {}, comments: row[21] || ""
    };
    for (let i = 5; i <= 20; i++) {
      if(headers[i]) entry.scores[headers[i]] = row[i];
    }
    return entry;
  });
  return responseJSON({status: "success", data: entries});
}

function getSpreadsheet() { return SPREADSHEET_ID ? SpreadsheetApp.openById(SPREADSHEET_ID) : SpreadsheetApp.getActiveSpreadsheet(); }
function responseJSON(data) { return ContentService.createTextOutput(JSON.stringify(data)).setMimeType(ContentService.MimeType.JSON); }
                </textarea>
            </div>
        </div>

        <div class="bg-slate-800 p-6 rounded-xl border border-slate-700">
            <div class="flex items-center gap-4 mb-6">
                <div class="bg-blue-600 text-white w-10 h-10 rounded-full flex items-center justify-center font-bold text-lg">3</div>
                <h2 class="text-xl font-bold">Deploy as Web App</h2>
            </div>
            <ul class="list-disc pl-5 space-y-2 text-slate-300">
                <li>Click the big blue <strong>Deploy</strong> button (top right).</li>
                <li>Select <strong>New Deployment</strong>.</li>
                <li>Click the gear icon next to "Select type" and choose <strong>Web App</strong>.</li>
                <li><strong>Execute as:</strong> Me.</li>
                <li><strong>Who has access:</strong> <span class="text-red-400 font-bold">Anyone</span> (Important!).</li>
                <li>Click <strong>Deploy</strong>.</li>
                <li>Copy the <strong>Web App URL</strong> generated.</li>
                <li>Paste that URL into the <strong>Admin Dashboard</strong> (Database Connection).</li>
            </ul>
        </div>

    </div>

    <script>
        function copyCode() {
            const code = document.getElementById('scriptCode');
            code.select();
            document.execCommand('copy');
            alert("Code copied to clipboard!");
        }
    </script>
</body>
</html>
