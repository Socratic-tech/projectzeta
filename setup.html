<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Setup Guide - Vocational Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        /* Custom Cartoon-ish Styles */
        .cartoon-card { background-color: #F0F9FF; border: 2px dashed #3B82F6; border-radius: 1rem; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; padding: 2rem; position: relative; overflow: hidden; }
        .icon-circle { width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); margin-bottom: 1rem; z-index: 10; }
        .bg-pattern { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0.1; background-image: radial-gradient(#3B82F6 1px, transparent 1px); background-size: 20px 20px; z-index: 0; }
        
        /* Privacy Shield Animation */
        @keyframes pulse-shield {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .shield-icon { animation: pulse-shield 3s infinite ease-in-out; }
    </style>
    <script>
        function copyCode() {
            const codeText = document.getElementById('scriptCode').innerText;
            navigator.clipboard.writeText(codeText).then(() => {
                const btn = document.getElementById('copyBtn');
                btn.innerText = "Copied!";
                btn.classList.replace("bg-indigo-600", "bg-green-600");
                setTimeout(() => {
                    btn.innerText = "Copy Script Code";
                    btn.classList.replace("bg-green-600", "bg-indigo-600");
                }, 2000);
            });
        }
    </script>
</head>
<body class="bg-gray-50 text-gray-900 font-sans pb-20">

    <nav class="bg-white shadow border-b border-gray-200 mb-8 sticky top-0 z-50">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <h1 class="text-xl font-bold text-indigo-600 flex items-center gap-2">
                        <span class="material-icons">build_circle</span> Setup Wizard
                    </h1>
                </div>
                <div class="flex items-center">
                    <a href="index.html" class="text-gray-500 hover:text-indigo-600 font-medium flex items-center gap-1">
                        <span class="material-icons text-sm">arrow_back</span> Dashboard
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-4xl mx-auto px-4">
        
        <div class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-gray-900">Let's Get Connected!</h1>
            <p class="mt-4 text-xl text-gray-500">Follow these 6 steps to create your private database.</p>
        </div>

        <section class="mb-12 bg-teal-50 border-l-4 border-teal-500 p-6 rounded-r-xl shadow-sm flex flex-col md:flex-row gap-6 items-center">
            <div class="flex-shrink-0">
                <div class="bg-white p-4 rounded-full shadow-sm border border-teal-100">
                    <span class="material-icons text-5xl text-teal-500 shield-icon">security</span>
                </div>
            </div>
            <div>
                <h3 class="text-xl font-bold text-teal-900 mb-2">ðŸ”’ Your Student Data is 100% Private</h3>
                <p class="text-teal-800 text-sm leading-relaxed mb-2">
                    <strong>We do not see your data.</strong> This tool is a "static interface." When you enter data, it goes directly from this device to <strong>your personal Google Spreadsheet</strong>.
                </p>
                <p class="text-teal-800 text-sm leading-relaxed">
                    The creators of this site have no access to your students' names, scores, or logs. You own the database completely within your Google Drive. Only people you share your Spreadsheet with can see the data.
                </p>
            </div>
        </section>

        <section class="mb-12 bg-white p-6 rounded-xl shadow-sm border border-gray-200">
            <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
                <span class="bg-indigo-600 text-white w-8 h-8 flex items-center justify-center rounded-full text-sm font-bold mr-3 shadow">1</span>
                Create the Spreadsheet
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                <div class="prose text-gray-600">
                    <p class="mb-3">1. Go to <a href="https://sheets.google.com" target="_blank" class="text-indigo-600 font-bold hover:underline">sheets.google.com</a>.</p>
                    <p class="mb-3">2. Click the giant <strong class="text-green-600">+</strong> to start a blank sheet.</p>
                    <p class="mb-3">3. Rename it to: <br><span class="font-mono bg-gray-100 text-indigo-700 px-2 py-1 rounded border border-gray-300 mt-1 inline-block">Vocational Tracker Database</span></p>
                    <p class="text-xs text-gray-400 italic">Don't worry about columns; the code does that later!</p>
                </div>
                <div class="cartoon-card bg-green-50 border-green-300">
                    <div class="bg-pattern"></div>
                    <div class="icon-circle bg-green-500 text-white">
                        <span class="material-icons text-4xl">table_view</span>
                    </div>
                    <div class="z-10 text-center font-bold text-green-800">"New Spreadsheet"</div>
                    <div class="z-10 text-xs text-green-600 mt-1">sheets.google.com</div>
                </div>
            </div>
        </section>

        <section class="mb-12 bg-white p-6 rounded-xl shadow-sm border border-gray-200">
            <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
                <span class="bg-indigo-600 text-white w-8 h-8 flex items-center justify-center rounded-full text-sm font-bold mr-3 shadow">2</span>
                Open Script Editor
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                <div class="text-gray-600">
                    <p class="mb-4">In your new Google Sheet, look at the top menu.</p>
                    <p class="mb-2">1. Click <strong>Extensions</strong>.</p>
                    <p class="mb-2">2. Click <strong>Apps Script</strong>.</p>
                    <p class="text-sm mt-3 text-gray-400">This opens a new tab where the "Brain" of the app lives.</p>
                </div>
                <div class="cartoon-card bg-yellow-50 border-yellow-300">
                    <div class="bg-pattern"></div>
                    <div class="icon-circle bg-yellow-500 text-white">
                        <span class="material-icons text-4xl">extension</span>
                    </div>
                    <div class="z-10 flex flex-col gap-2">
                        <span class="bg-white px-3 py-1 rounded shadow text-xs font-bold text-gray-700">Extensions</span>
                        <span class="bg-white px-3 py-1 rounded shadow text-xs font-bold text-gray-700 flex items-center gap-1">
                            <span class="material-icons text-xs text-blue-500">code</span> Apps Script
                        </span>
                    </div>
                </div>
            </div>
        </section>

        <section class="mb-12 bg-white p-6 rounded-xl shadow-sm border border-gray-200">
            <h2 class="text-2xl font-bold text-gray-900 mb-4 flex items-center">
                <span class="bg-indigo-600 text-white w-8 h-8 flex items-center justify-center rounded-full text-sm font-bold mr-3 shadow">3</span>
                Copy & Paste Code
            </h2>
            
            <p class="text-gray-600 mb-4">Delete the default code (<code>function myFunction...</code>) and paste this:</p>

            <div class="relative mb-6 group">
                <button id="copyBtn" onclick="copyCode()" class="absolute top-2 right-2 bg-indigo-600 text-white text-xs font-bold px-4 py-2 rounded-full hover:bg-indigo-700 transition shadow-lg z-20 flex items-center gap-1">
                    <span class="material-icons text-xs">content_copy</span> Copy Script Code
                </button>
                <div class="h-64 overflow-y-auto bg-gray-900 text-gray-300 p-4 rounded-lg shadow-inner border border-gray-700 text-xs font-mono leading-relaxed relative">
                    <pre id="scriptCode">
function doGet(e) {
  const action = e.parameter.action;
  if (action === "getStudents") return getStudents();
  if (action === "getJobSites") return getJobSites();
  if (action === "getEntries") return getEntries();
  return responseJSON({ status: "error", message: "Invalid action" });
}

function doPost(e) {
  try {
    const data = JSON.parse(e.postData.contents);
    const action = data.action;
    
    // Password Check
    if (action === "verifyPassword") return verifyPassword(data);

    if (action === "addEntry") return addEntry(data);
    if (action === "addStudent") return addStudent(data);
    if (action === "addJobSite") return addJobSite(data);
    if (action === "deleteJobSite") return deleteJobSite(data);
    
    return responseJSON({ status: "error" });
  } catch (error) { 
    return responseJSON({ status: "error", message: error.toString() }); 
  }
}

function verifyPassword(data) {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  let sheet = ss.getSheetByName("Settings");
  
  if (!sheet) {
    sheet = ss.insertSheet("Settings");
    sheet.appendRow(["Config Name", "Value"]);
    sheet.appendRow(["Admin Password", "1234"]); 
    sheet.appendRow(["Note", "Change cell B2 to update password"]);
  }
  
  const storedPassword = sheet.getRange("B2").getValue().toString();
  
  if (String(data.password) === storedPassword) {
    return responseJSON({ status: "success" });
  } else {
    return responseJSON({ status: "error" });
  }
}

function getStudents() {
  const sheet = getSheet("Students");
  const data = sheet.getDataRange().getValues();
  const students = [];
  for (let i = 1; i < data.length; i++) {
    if (data[i][0]) students.push({ student_id: data[i][0], name: data[i][1] });
  }
  return responseJSON({ data: students });
}

function getJobSites() {
  const sheet = getSheet("JobSites");
  const data = sheet.getDataRange().getValues();
  const sites = [];
  for (let i = 1; i < data.length; i++) {
    if (data[i][0]) sites.push(data[i][0]);
  }
  return responseJSON({ data: sites.sort() });
}

function getEntries() {
  const sheet = getSheet("Entries");
  const data = sheet.getDataRange().getValues();
  const entries = [];
  for (let i = 1; i < data.length; i++) {
    if (data[i][2]) { 
      let scores = [];
      try { scores = JSON.parse(data[i][5]); } catch(e) { scores = []; }
      entries.push({
        timestamp: data[i][0], date: data[i][1], student_id: data[i][2],
        job_site: data[i][3], evaluator: data[i][4], scores: scores, comments: data[i][6]
      });
    }
  }
  return responseJSON({ data: entries });
}

function addEntry(data) {
  const sheet = getSheet("Entries");
  sheet.appendRow([new Date(), data.date, data.student_id, data.job_site, data.evaluator, data.scores, data.comments]);
  return responseJSON({ status: "success" });
}

function addStudent(data) {
  const sheet = getSheet("Students");
  const id = "STU" + Date.now(); 
  sheet.appendRow([id, data.name]);
  return responseJSON({ status: "success", id: id });
}

function addJobSite(data) {
  const sheet = getSheet("JobSites");
  sheet.appendRow([data.site_name]);
  return responseJSON({ status: "success" });
}

function deleteJobSite(data) {
  const sheet = getSheet("JobSites");
  const rows = sheet.getDataRange().getValues();
  for (let i = rows.length - 1; i >= 0; i--) {
    if (rows[i][0] === data.site_name) sheet.deleteRow(i + 1);
  }
  return responseJSON({ status: "success" });
}

function getSheet(name) {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  let sheet = ss.getSheetByName(name);
  if (!sheet) {
    sheet = ss.insertSheet(name);
    if (name === "Students") sheet.appendRow(["Student ID", "Name"]);
    if (name === "JobSites") sheet.appendRow(["Site Name"]);
    if (name === "Entries") sheet.appendRow(["Timestamp", "Date", "Student ID", "Job Site", "Evaluator", "Scores", "Comments"]);
  }
  return sheet;
}

function responseJSON(data) {
  return ContentService.createTextOutput(JSON.stringify(data)).setMimeType(ContentService.MimeType.JSON);
}
                    </pre>
                </div>
            </div>
            
            <div class="flex items-center gap-2 text-sm text-gray-500 bg-gray-50 p-3 rounded">
                <span class="material-icons text-gray-400">save</span>
                <span>Click the <strong>Floppy Disk Icon</strong> to Save. Name it "Vocational Backend".</span>
            </div>
        </section>

        <section class="mb-12 bg-white p-6 rounded-xl shadow-sm border border-gray-200">
            <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
                <span class="bg-indigo-600 text-white w-8 h-8 flex items-center justify-center rounded-full text-sm font-bold mr-3 shadow">4</span>
                Deploy (The Important Part!)
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                <div>
                    <p class="text-gray-600 mb-4">Click <strong>Deploy</strong> (top right) â†’ <strong>New Deployment</strong>.</p>
                    <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded-r">
                        <h3 class="font-bold text-red-800 text-sm mb-2">MATCH THESE SETTINGS:</h3>
                        <ul class="space-y-3 text-sm">
                            <li class="flex items-center">
                                <span class="material-icons text-gray-400 mr-2 text-sm">settings</span>
                                <span>Type: <strong>Web App</strong> (Click the gear)</span>
                            </li>
                            <li class="flex items-center">
                                <span class="material-icons text-gray-400 mr-2 text-sm">person</span>
                                <span>Execute as: <strong class="text-green-600">Me</strong></span>
                            </li>
                            <li class="flex items-center">
                                <span class="material-icons text-red-500 mr-2 text-sm">lock_open</span>
                                <span>Access: <strong class="bg-red-200 px-1 rounded text-red-900">Anyone</strong></span>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="cartoon-card bg-purple-50 border-purple-300">
                    <div class="bg-pattern"></div>
                    <div class="icon-circle bg-purple-500 text-white">
                        <span class="material-icons text-4xl">rocket_launch</span>
                    </div>
                    <div class="z-10 bg-white p-3 rounded shadow-lg w-full max-w-xs space-y-2">
                        <div class="flex justify-between text-xs text-gray-500"><span>Who has access:</span> <span class="font-bold text-red-500">Anyone</span></div>
                        <div class="h-2 bg-gray-100 rounded overflow-hidden"><div class="h-full bg-purple-500 w-2/3"></div></div>
                        <div class="text-center font-bold text-purple-700 text-sm">Deploying...</div>
                    </div>
                </div>
            </div>
            
            <div class="mt-6 text-xs text-gray-500 text-center">
                * If Google asks for permission: Click "Review Permissions" â†’ Select Account â†’ "Advanced" â†’ "Go to (unsafe)".
            </div>
        </section>

        <section class="mb-12 bg-white p-6 rounded-xl shadow-sm border border-gray-200">
            <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
                <span class="bg-indigo-600 text-white w-8 h-8 flex items-center justify-center rounded-full text-sm font-bold mr-3 shadow">5</span>
                Get Your Link
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                <div class="text-gray-600">
                    <p class="mb-4">After deploying, you will see a <strong>Web App URL</strong>.</p>
                    <p class="mb-4">It looks like a long mess of random letters.</p>
                    <button class="bg-gray-100 text-gray-500 font-mono text-xs p-3 rounded w-full text-left truncate border border-gray-300 cursor-not-allowed">
                        https://script.google.com/macros/s/AKfycbx.../exec
                    </button>
                    <p class="mt-2 font-bold text-indigo-600">Copy this URL!</p>
                </div>
                 <div class="cartoon-card bg-blue-50 border-blue-300">
                    <div class="bg-pattern"></div>
                    <div class="icon-circle bg-blue-500 text-white">
                        <span class="material-icons text-4xl">link</span>
                    </div>
                    <div class="z-10 text-center">
                        <div class="text-4xl">ðŸ”—</div>
                        <div class="font-bold text-blue-900 mt-2">Copy the Key</div>
                    </div>
                </div>
            </div>
        </section>

        <section class="mb-12 bg-white p-6 rounded-xl shadow-sm border border-gray-200">
            <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
                <span class="bg-indigo-600 text-white w-8 h-8 flex items-center justify-center rounded-full text-sm font-bold mr-3 shadow">6</span>
                Finish Setup
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                <div class="prose text-sm text-gray-600 space-y-4">
                    <div class="flex gap-3">
                        <span class="font-bold text-indigo-600">A.</span>
                        <span>Go to <a href="admin.html" class="underline font-bold">Admin</a> and paste the URL you copied.</span>
                    </div>
                    <div class="flex gap-3">
                        <span class="font-bold text-indigo-600">B.</span>
                        <span>The system will ask for a PIN. Use the default: <strong class="bg-gray-200 px-1 rounded">1234</strong>.</span>
                    </div>
                    <div class="flex gap-3">
                        <span class="font-bold text-indigo-600">C.</span>
                        <span>To change the password: Go back to your <strong>Google Sheet</strong>. Look for the <strong>"Settings"</strong> tab at the bottom. Change cell <strong>B2</strong>.</span>
                    </div>
                </div>

                <div class="cartoon-card bg-orange-50 border-orange-300">
                    <div class="bg-pattern"></div>
                    <div class="icon-circle bg-orange-500 text-white">
                        <span class="material-icons text-4xl">password</span>
                    </div>
                    <div class="z-10 bg-white p-2 rounded shadow border border-gray-200 w-48 text-center">
                        <div class="text-xs text-gray-400 uppercase font-bold mb-1">Google Sheet Cell B2</div>
                        <div class="text-2xl font-mono tracking-widest text-gray-800">1234</div>
                        <div class="text-[10px] text-green-600 mt-1">âœŽ Edit to change</div>
                    </div>
                </div>
            </div>
        </section>

    </div>

</body>
</html>
